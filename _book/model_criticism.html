<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.339">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Models Demystified - 3&nbsp; Knowing Your Model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./estimation.html" rel="next">
<link href="./linear_models.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./linear_models.html">Linear Models</a></li><li class="breadcrumb-item"><a href="./model_criticism.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Knowing Your Model</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Models Demystified</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/m-clark/book-of-models" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./Models-Demystified.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Linear Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./linear_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The Foundation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model_criticism.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Knowing Your Model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">How Did We Get Here?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./generalized_linear_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Generalized Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./linear_model_extensions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Extending the Linear Model</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machine_learning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Core Concepts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ml_common_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Common Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ml_more.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">More ML</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Other Considerations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data Issues in Modeling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./causal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Causal Modeling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./misc_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Misc Models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dataset_descriptions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Dataset Descriptions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./matrix_operations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Matrix Operations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix_placeholder.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Other to come</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#sec-knowing-key" id="toc-sec-knowing-key" class="nav-link active" data-scroll-target="#sec-knowing-key"><span class="header-section-number">3.1</span> Key Ideas</a>
  <ul class="collapse">
  <li><a href="#sec-knowing-why" id="toc-sec-knowing-why" class="nav-link" data-scroll-target="#sec-knowing-why"><span class="header-section-number">3.1.1</span> Why this matters</a></li>
  <li><a href="#sec-knowing-good" id="toc-sec-knowing-good" class="nav-link" data-scroll-target="#sec-knowing-good"><span class="header-section-number">3.1.2</span> Good to know</a></li>
  </ul></li>
  <li><a href="#sec-knowing-metrics" id="toc-sec-knowing-metrics" class="nav-link" data-scroll-target="#sec-knowing-metrics"><span class="header-section-number">3.2</span> Model Metrics</a>
  <ul class="collapse">
  <li><a href="#sec-knowing-reg-metrics" id="toc-sec-knowing-reg-metrics" class="nav-link" data-scroll-target="#sec-knowing-reg-metrics"><span class="header-section-number">3.2.1</span> Regression Metrics</a></li>
  <li><a href="#sec-knowing-class-metrics" id="toc-sec-knowing-class-metrics" class="nav-link" data-scroll-target="#sec-knowing-class-metrics"><span class="header-section-number">3.2.2</span> Classification Metrics</a></li>
  </ul></li>
  <li><a href="#model-visualizations" id="toc-model-visualizations" class="nav-link" data-scroll-target="#model-visualizations"><span class="header-section-number">3.3</span> Model Visualizations</a>
  <ul class="collapse">
  <li><a href="#regression" id="toc-regression" class="nav-link" data-scroll-target="#regression"><span class="header-section-number">3.3.1</span> Regression</a></li>
  <li><a href="#classification" id="toc-classification" class="nav-link" data-scroll-target="#classification"><span class="header-section-number">3.3.2</span> Classification</a></li>
  </ul></li>
  <li><a href="#wrapping-up" id="toc-wrapping-up" class="nav-link" data-scroll-target="#wrapping-up"><span class="header-section-number">3.4</span> Wrapping Up</a></li>
  <li><a href="#additional-resources" id="toc-additional-resources" class="nav-link" data-scroll-target="#additional-resources"><span class="header-section-number">3.5</span> Additional Resources</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/m-clark/book-of-models/edit/main/model_criticism.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./linear_models.html">Linear Models</a></li><li class="breadcrumb-item"><a href="./model_criticism.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Knowing Your Model</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-knowing" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Knowing Your Model</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>

<p>In addition to giving the world one of the greatest television show theme songs – Quincy Jones’ <em>The Streetbeater</em> – <em>Sanford &amp; Son</em> gave us an insightful quote for offering criticism: “You big dummy.” While we don’t advocate for swearing at or denigrating your model, how do you know if your model is performing up to your expectations? It is easy to look at your coefficients, <em>t</em>-values, and an adjusted <span class="math inline">\(R^2\)</span>, and say, “Wow! Look at this great model!” Your friends will be envious of such terrific <em>p</em>-values, and all of the strangers that you see at social functions will be impressed. What happens if that model falls apart on new data, though? What if a stakeholder wants to know exactly how a prediction was made for a specific business decision? Sadly, all of the stars that you gleefully pointed towards in your console will not offer you any real answers.</p>
<p>Instead of falling in immediate love with your model, you should ask real questions of it. How does it perform on different slices of data? Do predictions make sense? Is your classification cut-point appropriate? In other words, you should criticize your model before you decide it can be used for its intended purposes. Remember that it is <strong>data modeling</strong>, not <strong>data truthing</strong>. In other words, you should always be prepared to call your model a “big dummy”.</p>
<section id="sec-knowing-key" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="sec-knowing-key"><span class="header-section-number">3.1</span> Key Ideas</h2>
<ul>
<li>Metrics can help you assess how well your model is performing, and they can also help you compare different models.</li>
<li>Different metrics can be used depending on the goals of your model.</li>
<li>Visualizations can help you understand how your model is making predictions and which variables are important.</li>
</ul>
<section id="sec-knowing-why" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="sec-knowing-why"><span class="header-section-number">3.1.1</span> Why this matters</h3>
<p>It’s never good enough to simply get model results. You need to know how well your model is performing and how it is making predictions. You also should be comparing your model to other alternatives. Doing so provides more confidence in your model and helps you to understand how it is working, and just as importantly, where it fails. This is actionable knowledge.</p>
</section>
<section id="sec-knowing-good" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="sec-knowing-good"><span class="header-section-number">3.1.2</span> Good to know</h3>
<p>This takes some of the things we see in other chapters on linear models and machine learning. We’d suggest have linear model basics down pretty well.</p>
</section>
</section>
<section id="sec-knowing-metrics" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="sec-knowing-metrics"><span class="header-section-number">3.2</span> Model Metrics</h2>
<p>Regression and classification have very different metrics for assessing model performance. We want to give you a sample of some of the more common one, but we also want to acknowledge that there are many more that you can use! We would always recommend looking at a few different metrics to get a better sense of how your model is performing.</p>
<section id="sec-knowing-reg-metrics" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="sec-knowing-reg-metrics"><span class="header-section-number">3.2.1</span> Regression Metrics</h3>
<p>Recall that a primary goal of our standard linear model is to produce <span class="math inline">\(\hat{y}\)</span> – the predicted outcome. Since we are predicting a value, we need to be able to compare that prediction to its actual value. The closer our prediction is to the actual value, the better our model is performing.</p>
<p>Before we create a model, we are going to read in our data and then create two different splits within our data: a <strong>training</strong> set and a <strong>testing</strong> set. In other words, we are going to <strong>partition</strong> our data so that we can train a model and then see how well that model does with new data.</p>
<div class="callout-info">
<p>This basic split is the foundation of <strong>cross-validation</strong>. Cross-validation is a method for partitioning data into training and testing sets, but it does so in a way that allows you to train and test your model multiple times. We will not be covering cross-validation in this book, but we would strongly encourage you to learn more about it.</p>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>reviews <span class="ot">=</span> <span class="fu">read.csv</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/movie_reviews_processed.csv"</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>initial_split <span class="ot">=</span> <span class="fu">sample</span>(</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(reviews), </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> <span class="fu">nrow</span>(reviews) <span class="sc">*</span> .<span class="dv">75</span>, </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">replace =</span> <span class="cn">FALSE</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>training_data <span class="ot">=</span> reviews[initial_split, ]</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>testing_data <span class="ot">=</span> reviews[<span class="sc">-</span>initial_split, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>reviews <span class="op">=</span> pd.read_csv(<span class="st">"data/movie_reviews_processed.csv"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>initial_split <span class="op">=</span> np.random.choice(</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    reviews.index, </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    size <span class="op">=</span> <span class="bu">int</span>(reviews.shape[<span class="dv">0</span>] <span class="op">*</span> <span class="fl">.75</span>), </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    replace <span class="op">=</span> <span class="va">False</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>training_data <span class="op">=</span> reviews.iloc[initial_split, :]</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>testing_data <span class="op">=</span> reviews.iloc[<span class="op">-</span>initial_split, :]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>You’ll notice that we created training data with 75% of our data and we will use the other 25% to test our model. With training data in hand, let’s produce a model to predict rating</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>model_train <span class="ot">=</span> <span class="fu">lm</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  rating <span class="sc">~</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    review_year_0 <span class="sc">+</span> release_year_0 <span class="sc">+</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    age_sc <span class="sc">+</span> length_minutes_sc <span class="sc">+</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    total_reviews_sc <span class="sc">+</span> word_count_sc <span class="sc">+</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    genre <span class="sc">+</span> gender <span class="sc">+</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    reviewer_type <span class="sc">+</span> work_status <span class="sc">+</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    season, </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  training_data</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> [<span class="st">"review_year_0"</span>, <span class="st">"release_year_0"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"age_sc"</span>, <span class="st">"length_minutes_sc"</span>, </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"total_reviews_sc"</span>, <span class="st">"word_count_sc"</span>, </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"genre"</span>, <span class="st">"gender"</span>, </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"reviewer_type"</span>, <span class="st">"work_status"</span>, </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"season"</span>]</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>X_features <span class="op">=</span> training_data[features]</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>X_features <span class="op">=</span> sm.add_constant(X_features)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>X_features <span class="op">=</span> pd.get_dummies(X_features)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>X_features <span class="op">=</span> X_features.drop(</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  columns<span class="op">=</span>[<span class="st">"work_status_Unemployed"</span>, <span class="st">"season_Winter"</span>]</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>X_features <span class="op">=</span> X_features.values.astype(<span class="bu">float</span>)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>y_target <span class="op">=</span> training_data[<span class="st">"rating"</span>].values.astype(<span class="bu">float</span>)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>model_train <span class="op">=</span> sm.OLS(y_target, X_features).fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Now that we have a model on our training data, we can use it to make predictions on our test data:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">=</span> <span class="fu">predict</span>(model_train, <span class="at">newdata =</span> testing_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>X_features_testing <span class="op">=</span> testing_data[features]</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>X_features_testing <span class="op">=</span> sm.add_constant(X_features_testing)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>X_features_testing <span class="op">=</span> pd.get_dummies(X_features_testing)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>X_features_testing <span class="op">=</span> X_features_testing.drop(</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  columns<span class="op">=</span>[<span class="st">"work_status_Unemployed"</span>, <span class="st">"season_Winter"</span>]</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>X_features_testing <span class="op">=</span> X_features_testing.values.astype(<span class="bu">float</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>y_target_testing <span class="op">=</span> testing_data[<span class="st">"rating"</span>].values.astype(<span class="bu">float</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> model_train.predict(X_features_testing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>The goal now is to find out how close our predictions match reality. Let’s look at them first:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="model_criticism_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Obviously, our points for do not make a perfect line. Therefore, we need to determine how far off we are. There are a number of metrics that can be used to measure this. We’ll go through a few of them here.</p>
<section id="sec-knowing-metrics-mse" class="level4" data-number="3.2.1.1">
<h4 data-number="3.2.1.1" class="anchored" data-anchor-id="sec-knowing-metrics-mse"><span class="header-section-number">3.2.1.1</span> Mean Squared Error</h4>
<p>One of the most common metrics is the mean squared error (MSE). The MSE is the average of the squared differences between the predicted and actual values. It is calculated as follows:</p>
<p><span class="math display">\[MSE = \frac{1}{n}\sum_{i=1}^{n}(y_i - \hat{y}_i)^2\]</span></p>
<p>MSE is a great metric for penalizing large errors. Since errors are squared, the larger the error, the larger the penalty.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>((testing_data<span class="sc">$</span>rating <span class="sc">-</span> predictions)<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1070559</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>Metrics<span class="sc">::</span><span class="fu">mse</span>(testing_data<span class="sc">$</span>rating, predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1070559</code></pre>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>np.mean((testing_data.rating <span class="op">-</span> predictions)<span class="op">**</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.1063425484588757</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>mean_squared_error(testing_data.rating, predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.1063425484588757</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="sec-knowing-metrics-mae" class="level4" data-number="3.2.1.2">
<h4 data-number="3.2.1.2" class="anchored" data-anchor-id="sec-knowing-metrics-mae"><span class="header-section-number">3.2.1.2</span> Mean Absolute Error</h4>
<p>The mean absolute error (MAE) is the average of the absolute differences between the predicted and actual values. It is calculated as follows:</p>
<p><span class="math display">\[MAE = \frac{1}{n}\sum_{i=1}^{n}|y_i - \hat{y}_i|\]</span></p>
<p>MAE is a great metric when all you really want to know is how far off your predictions are from the actual values. It is not as sensitive to large errors as the MSE.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">abs</span>(testing_data<span class="sc">$</span>rating <span class="sc">-</span> predictions))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2595524</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>Metrics<span class="sc">::</span><span class="fu">mae</span>(testing_data<span class="sc">$</span>rating, predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2595524</code></pre>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_absolute_error</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>np.mean(<span class="bu">abs</span>(testing_data.rating <span class="op">-</span> predictions))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.2590764679706437</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>mean_absolute_error(testing_data.rating, predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.2590764679706437</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="sec-knowing-metrics-rmse" class="level4" data-number="3.2.1.3">
<h4 data-number="3.2.1.3" class="anchored" data-anchor-id="sec-knowing-metrics-rmse"><span class="header-section-number">3.2.1.3</span> Root Mean Squared Error</h4>
<p>Perhaps the regression metric that you are most likely to encounter in the wild, the root mean squared error (RMSE) is the square root of the average of the squared differences between the predicted and actual values. It is calculated as follows:</p>
<p><span class="math display">\[RMSE = \sqrt{\frac{1}{n}\sum_{i=1}^{n}(y_i - \hat{y}_i)^2}\]</span></p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">mean</span>((testing_data<span class="sc">$</span>rating <span class="sc">-</span> predictions)<span class="sc">^</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.327194</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>Metrics<span class="sc">::</span><span class="fu">rmse</span>(testing_data<span class="sc">$</span>rating, predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.327194</code></pre>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>np.sqrt(np.mean((testing_data.rating <span class="op">-</span> predictions)<span class="op">**</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.32610205221506305</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>np.sqrt(mean_squared_error(testing_data.rating, predictions))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.32610205221506305</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="sec-knowing-metrics-mape" class="level4" data-number="3.2.1.4">
<h4 data-number="3.2.1.4" class="anchored" data-anchor-id="sec-knowing-metrics-mape"><span class="header-section-number">3.2.1.4</span> Mean Absolute Percentage Error</h4>
<p>The mean absolute percentage error (MAPE) is the average of the absolute differences between the predicted and actual values, expressed as a percentage of the actual values. It is calculated as follows:</p>
<p><span class="math display">\[MAPE = \frac{1}{n}\sum_{i=1}^{n}\frac{|y_i - \hat{y}_i|}{y_i}\]</span></p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abs</span>(testing_data<span class="sc">$</span>rating <span class="sc">-</span> predictions) <span class="sc">/</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    testing_data<span class="sc">$</span>rating</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.09168645</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>Metrics<span class="sc">::</span><span class="fu">mape</span>(testing_data<span class="sc">$</span>rating, predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.09168645</code></pre>
</div>
</div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_absolute_percentage_error</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>np.mean(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">abs</span>(testing_data.rating <span class="op">-</span> predictions) <span class="op">/</span> </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    testing_data.rating</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.0915330112750992</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>mean_absolute_percentage_error(testing_data.rating, predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.0915330112750992</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="which-to-use" class="level4" data-number="3.2.1.5">
<h4 data-number="3.2.1.5" class="anchored" data-anchor-id="which-to-use"><span class="header-section-number">3.2.1.5</span> Which To Use?</h4>
<p>In the end, it won’t hurt to look at a few of these metrics to get a better idea of how well your model is performing. You will <strong>always</strong> be using these metrics to compare different models, so use a few of them to get a better sense of how well your models are performing relative to one another. Does adding a variable help drive down RMSE, indicating that the variable helps to reduce large errors? In other words, does adding complexity to your model provide a big reduction in error? If adding variables doesn’t help reduce error, do you really need to include it in your modelU+0203D;</p>
</section>
</section>
<section id="sec-knowing-class-metrics" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="sec-knowing-class-metrics"><span class="header-section-number">3.2.2</span> Classification Metrics</h3>
<p>Whenever we are classifying outcomes, we don’t have the same ability to compare a predicted score to an observed score – instead, we are going to use the predicted probability of an outcome, establish a cut-point for that probability, convert everything below that cut-point to 0, and then convert everything at or above that cut-point to 1. We can then compare a table predicted and actual <strong>classes</strong>.</p>
<p>Let’s start with a model to predict whether a review is “good” or “bad”. We will use the same training and testing data that we created above.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>logistic_model_train <span class="ot">=</span> <span class="fu">glm</span>(</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  rating_good <span class="sc">~</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    review_year_0 <span class="sc">+</span> release_year_0 <span class="sc">+</span> </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    age_sc <span class="sc">+</span> length_minutes_sc <span class="sc">+</span> </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    total_reviews_sc <span class="sc">+</span> word_count_sc <span class="sc">+</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    genre <span class="sc">+</span> gender <span class="sc">+</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    reviewer_type <span class="sc">+</span> work_status <span class="sc">+</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    season, </span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  training_data, </span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.genmod.families <span class="im">import</span> Binomial</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>logistic_model_train <span class="op">=</span> sm.GLM(</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    training_data.rating_good,</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    X_features,</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    family <span class="op">=</span> Binomial()</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>).fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Now that we have our model trained, we can use it to get the predicted probabilities for each observation.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">=</span> <span class="fu">predict</span>(logistic_model_train, </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">newdata =</span> testing_data, </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">type =</span> <span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> logistic_model_train.predict(X_features_testing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>We are going to take those probability values and make a decision to convert everything above .49 to the positive class (a “good” review). It is a bold assumption, but one that we will make at first!</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">=</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> .<span class="dv">49</span> , <span class="dv">1</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> np.where(predictions <span class="op">&gt;</span> <span class="fl">.49</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> pd.Series(predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<section id="sec-knowing-metrics-confusion" class="level4" data-number="3.2.2.1">
<h4 data-number="3.2.2.1" class="anchored" data-anchor-id="sec-knowing-metrics-confusion"><span class="header-section-number">3.2.2.1</span> Confusion Matrix</h4>
<p>The confusion matrix is a table that shows the number of correct and incorrect predictions made by the model.</p>
<p>Let’s give some names to each element in that table, so that we have a little more clarity about what they signify:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>      0      1
0 TN:90  FN:19
1 FP:27 TP:114</code></pre>
</div>
</div>
<ul>
<li><p><strong>TN</strong>: A True Negative is an outcome where the model correctly predicts the negative class – the model correctly predicted that the review was not good.</p></li>
<li><p><strong>FN</strong>: A False Negative is an outcome where the model incorrectly predicts the negative class – the model incorrectly predicted that the review was not good.</p></li>
<li><p><strong>FP</strong>: A False Positive is an outcome where the model incorrectly predicts the positive class – the model incorrectly predicted that the review was good.</p></li>
<li><p><strong>TP</strong>: A True Positive is an outcome where the model correctly predicts the positive class – the model correctly predicted that the review was good.</p></li>
</ul>
<p>In an ideal world, we would have all of our observations fitting nicely in the diagonal of that table. Unfortunately, we don’t live in the ideal world and we always have values in the off diagonal. The more values we have in the off diagonal (i.e., in the FN and FP spots), the worse our model is at classifying outcomes.</p>
<p>Let’s look at some metrics that will help to see if we’ve got a suitable model or not.</p>
</section>
<section id="accuracy" class="level4" data-number="3.2.2.2">
<h4 data-number="3.2.2.2" class="anchored" data-anchor-id="accuracy"><span class="header-section-number">3.2.2.2</span> Accuracy</h4>
<p>Accuracy is the first thing you see and the last thing that you trust! Of all the metrics to assess the quality of classification, accuracy is the easiest to cheat. If you have any <strong>class imbalance</strong> (i.e., one class within the target has far more observations than the other), you can get a high accuracy by simply predicting the majority class all of the time.</p>
<p>Accuracy’s allure is in its simplicity. The accuracy is the proportion of correct predictions made by the model. It is calculated as follows:</p>
<p><span class="math display">\[Accuracy = \frac{TP + TN}{TP + TN + FP + FN}\]</span></p>
<p>From our table above, we can calculate the accuracy as follows:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>TN <span class="ot">=</span> <span class="dv">88</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>TP <span class="ot">=</span> <span class="dv">123</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>FN <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>FP <span class="ot">=</span> <span class="dv">29</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>(TN <span class="sc">+</span> TP) <span class="sc">/</span> (TN <span class="sc">+</span> TP <span class="sc">+</span> FN <span class="sc">+</span> FP)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.844</code></pre>
</div>
</div>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>TN <span class="op">=</span> <span class="dv">88</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>TP <span class="op">=</span> <span class="dv">123</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>FN <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>FP <span class="op">=</span> <span class="dv">29</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>(TN <span class="op">+</span> TP) <span class="op">/</span> (TN <span class="op">+</span> TP <span class="op">+</span> FN <span class="op">+</span> FP)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.844</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>To get around the false sense of confidence that accuracy alone can promote, we can look at a few other metrics.</p>
<div class="callout callout-style-simple callout-warning">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Seriously, accuracy alone should not be trusted unless you have a perfectly even split in the target! If you find yourself in a meeting where people are presenting their classification models and they only talk about accuracy, you should be very skeptical of their model; this is especially true when those accuracy values seem too good to be true.</p>
</div>
</div>
</div>
</section>
<section id="sec-knowing-metrics-sensitivity" class="level4" data-number="3.2.2.3">
<h4 data-number="3.2.2.3" class="anchored" data-anchor-id="sec-knowing-metrics-sensitivity"><span class="header-section-number">3.2.2.3</span> Sensitivity/Recall/True Positive Rate</h4>
<p>Sensitivity, also known as recall or the true positive rate, is the proportion of <strong>actual positives</strong> that are correctly identified as such. If you want to know how well your model predicts the positive class, sensitivity is the metric for you. It is calculated as follows:</p>
<p><span class="math display">\[Sensitivity = \frac{TP}{TP + FN}\]</span></p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>TP <span class="sc">/</span> (TP <span class="sc">+</span> FN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.924812</code></pre>
</div>
</div>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>TP <span class="op">/</span> (TP <span class="op">+</span> FN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.924812030075188</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="sec-knowing-metrics-specificity" class="level4" data-number="3.2.2.4">
<h4 data-number="3.2.2.4" class="anchored" data-anchor-id="sec-knowing-metrics-specificity"><span class="header-section-number">3.2.2.4</span> Specificity/True Negative Rate</h4>
<p>Specificity, also known as the true negative rate, is the proportion of <strong>actual negatives</strong> that are correctly identified as such. If you want to know how well your model will work with the negative class, specificity is a great metric. It is calculated as follows:</p>
<p><span class="math display">\[Specificity = \frac{TN}{TN + FP}\]</span></p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-13-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>TN <span class="sc">/</span> (TN <span class="sc">+</span> FP)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7521368</code></pre>
</div>
</div>
</div>
<div id="tabset-13-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>TN <span class="op">/</span> (TN <span class="op">+</span> FP)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.7521367521367521</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="sec-knowing-metrics-precision" class="level4" data-number="3.2.2.5">
<h4 data-number="3.2.2.5" class="anchored" data-anchor-id="sec-knowing-metrics-precision"><span class="header-section-number">3.2.2.5</span> Precision/Positive Predictive Value</h4>
<p>The precision is the proportion of <strong>positive predictions</strong> that are correct. It is calculated as follows:</p>
<p><span class="math display">\[Precision = \frac{TP}{TP + FP}\]</span></p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-14-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>TP <span class="sc">/</span> (TP <span class="sc">+</span> FP)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8092105</code></pre>
</div>
</div>
</div>
<div id="tabset-14-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>TP <span class="op">/</span> (TP <span class="op">+</span> FP)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.8092105263157895</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="sec-knowing-metrics-npv" class="level4" data-number="3.2.2.6">
<h4 data-number="3.2.2.6" class="anchored" data-anchor-id="sec-knowing-metrics-npv"><span class="header-section-number">3.2.2.6</span> Negative Predictive Value</h4>
<p>The negative predictive value is the proportion of <strong>negative predictions</strong> that are correct. It is calculated as follows:</p>
<p><span class="math display">\[NPV = \frac{TN}{TN + FN}\]</span></p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-15-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-1" role="tab" aria-controls="tabset-15-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-2" role="tab" aria-controls="tabset-15-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-15-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-15-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>TN <span class="sc">/</span> (TN <span class="sc">+</span> FN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8979592</code></pre>
</div>
</div>
</div>
<div id="tabset-15-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>TN <span class="op">/</span> (TN <span class="op">+</span> FN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.8979591836734694</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>We can get almost all of that with the <code>confusionMatrix</code> function from the <code>caret</code> package in R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(<span class="fu">as.factor</span>(predictions), </span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">as.factor</span>(testing_data<span class="sc">$</span>rating_good), </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">positive =</span> <span class="st">"1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0  90  19
         1  27 114
                                         
               Accuracy : 0.816          
                 95% CI : (0.7623, 0.862)
    No Information Rate : 0.532          
    P-Value [Acc &gt; NIR] : &lt;2e-16         
                                         
                  Kappa : 0.629          
                                         
 Mcnemar's Test P-Value : 0.302          
                                         
            Sensitivity : 0.8571         
            Specificity : 0.7692         
         Pos Pred Value : 0.8085         
         Neg Pred Value : 0.8257         
             Prevalence : 0.5320         
         Detection Rate : 0.4560         
   Detection Prevalence : 0.5640         
      Balanced Accuracy : 0.8132         
                                         
       'Positive' Class : 1              
                                         </code></pre>
</div>
</div>
<p>We also get:</p>
<ul>
<li>kappa: A measure of how much better the model is than random guessing. It is calculated as follows:</li>
</ul>
<p><span class="math display">\[\kappa = \frac{Accuracy - ExpectedAccuracy}{1 - ExpectedAccuracy}\]</span></p>
<p>where the expected accuracy is calculated as follows:</p>
<p><span class="math display">\[ExpectedAccuracy = \frac{(TP + FN)(TP + FP) + (FP + TN)(FN + TN)}{(TP + TN + FP + FN)^2}\]</span></p>
<ul>
<li>Prevalence: The proportion of actual positives in the data. It is calculated as follows:</li>
</ul>
<p><span class="math display">\[Prevalence = \frac{TP + FN}{TP + TN + FP + FN}\]</span></p>
<ul>
<li>Balanced Accuracy: The average of the sensitivity (TPR) and specificity (TNR). It is calculated as follows:</li>
</ul>
<p><span class="math display">\[Balanced Accuracy = \frac{Sensitivity + Specificity}{2}\]</span></p>
</section>
<section id="ideal-decision-points" class="level4" data-number="3.2.2.7">
<h4 data-number="3.2.2.7" class="anchored" data-anchor-id="ideal-decision-points"><span class="header-section-number">3.2.2.7</span> Ideal Decision Points</h4>
<p>Earlier, we used a predicted probability value of 0.49 to establish our predicted class. That is a pretty bold assumption on our part and we should probably make sure that the cut-off value we choose is going to offer use the best performance.</p>
<p>To handle this task, we will start by creating a <strong>Receiver Operating Characteristic</strong> (ROC) curve. This curve plots the true positive rate (TPR) against the false positive rate (FPR) at various threshold settings. The <strong>area under the curve</strong> (AUC) is a measure of how well the model is able to distinguish between the two classes. The closer the AUC is to 1, the better the model is at distinguishing between the two classes.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-16-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-1" role="tab" aria-controls="tabset-16-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-16-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-2" role="tab" aria-controls="tabset-16-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-16-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-16-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>prediction_prob <span class="ot">=</span> <span class="fu">predict</span>(logistic_model_train, </span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>                           testing_data, </span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>roc <span class="ot">=</span> <span class="fu">roc</span>(</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>  testing_data<span class="sc">$</span>rating_good, </span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>  prediction_prob</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="model_criticism_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">auc</span>(roc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Area under the curve: 0.9231</code></pre>
</div>
</div>
</div>
<div id="tabset-16-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-16-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_curve, auc</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>fpr, tpr, thresholds <span class="op">=</span> roc_curve(</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>    testing_data.rating_good, </span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>    predictions</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>auc(fpr, tpr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.8308959005066789</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>With ROC curves and AUC values, we can get a sense of how well our model is able to distinguish between the two classes. Now we can find the ideal cut-point for balancing the TPR and FPR.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-17-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-1" role="tab" aria-controls="tabset-17-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-17-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-2" role="tab" aria-controls="tabset-17-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-17-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-17-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coords</span>(roc, <span class="st">"best"</span>, <span class="at">ret =</span> <span class="st">"threshold"</span>, <span class="at">transpose =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>threshold 
0.8018789 </code></pre>
</div>
</div>
</div>
<div id="tabset-17-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-17-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>thresholds[np.argmax(tpr <span class="op">-</span> fpr)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Those coordinates are going to give us the “best” decision cut-point. Instead of being naive about setting our probability to .5, this will give a cut-point that will lead to better classifications for our testing data.</p>
<p>We will leave it to you to take that ideal cut-point value and update your metrics to see how much of a difference it will make.</p>
<p>Whether it is a meager, modest, or meaningful improvement is going to vary from situation to situation, as will how you determine if your model is “good” or “bad”. If we look back to our original <code>Balanced Accuracy</code> value of 0.6490, we’d imagine that our model gets a True Positive or True Negative about 65% of the time, leaving us wrong 35% of the time. Is that good or bad?</p>
</section>
</section>
</section>
<section id="model-visualizations" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="model-visualizations"><span class="header-section-number">3.3</span> Model Visualizations</h2>
<p>Using various fit metrics to assess your model’s performance is critical for knowing how well it will do with new data. As good as it might be to know if it is useful, you might also want to know what is actually happening in the model. Which variables are important? How did a specific observation reach its predicted value?</p>
<p>For these tasks, and many others, we can turn to visualizations to gain a better understanding of our model. Afterall, we can’t really criticize something we don’t understand, can we? To help us along, we are going to use <code>DALEX</code> to create <strong>model explainers</strong>.</p>
<p>We will focus on two types of explainers: <strong>variable importance</strong> and <strong>localized predictions</strong>. We will look at them individually for regression and classification tasks.</p>
<section id="regression" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="regression"><span class="header-section-number">3.3.1</span> Regression</h3>
<p>We are going to add some more features to our model to make it a little more interesting, check that model’s performance, and then look at the <strong>Partial Dependence Plots</strong>, which will give us a good idea about the relationship between the features and the target.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-18-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-1" role="tab" aria-controls="tabset-18-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-18-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-2" role="tab" aria-controls="tabset-18-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-18-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-18-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DALEX)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>features <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"review_year_0"</span>, <span class="st">"release_year_0"</span>,</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"age_sc"</span>, <span class="st">"length_minutes_sc"</span>, </span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"total_reviews_sc"</span>, <span class="st">"word_count_sc"</span>, </span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"genre"</span>, <span class="st">"gender"</span>, </span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"reviewer_type"</span>, <span class="st">"work_status"</span>, </span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"season"</span>)</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>train_explain <span class="ot">=</span> <span class="fu">explain</span>(</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>  model_train, </span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> training_data[, features], </span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> training_data<span class="sc">$</span>rating,</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>train_performance <span class="ot">=</span> <span class="fu">model_performance</span>(train_explain)</span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a><span class="co"># train_performance # not shown</span></span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>train_var_effect <span class="ot">=</span> <span class="fu">model_profile</span>(train_explain, features)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(train_var_effect)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-r_perf-plot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="model_criticism_files/figure-html/fig-r_perf-plot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3.1: R Performance Plot</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-18-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-18-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dalex <span class="im">as</span> dx</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>train_explain <span class="op">=</span> dx.Explainer(</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>    model_train, </span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> X_features, </span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> training_data.rating,</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>    verbose <span class="op">=</span> <span class="va">False</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>train_performance <span class="op">=</span> train_explain.model_performance()</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>perf_plot <span class="op">=</span> train_performance.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>perf_plot.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-py_perf-plot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div>                        <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
        <script charset="utf-8" src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>                <div id="d88c1027-2628-4b36-aae1-dfc24bd3c2d4" class="plotly-graph-div" style="height:100%; width:100%;"></div>            <script type="text/javascript">                                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("d88c1027-2628-4b36-aae1-dfc24bd3c2d4")) {                    Plotly.newPlot(                        "d88c1027-2628-4b36-aae1-dfc24bd3c2d4",                        [{"line":{"shape":"hv"},"marker":{"color":"#46bac2"},"name":"RegressionResultsWrapper","x":[2.0105360506672554e-05,0.00087851507950365,0.001034842893965937,0.0011597164366521362,0.0016872452323783982,0.0018570331685667796,0.0018581892230185026,0.002059767681720004,0.002431704653085287,0.0030585423453168836,0.0033525970462386923,0.0035838170850426287,0.00390473258945212,0.005207971972182257,0.007589019539813391,0.007601540566587239,0.007894118911964565,0.008260061453387202,0.008606263902037448,0.008680571104058288,0.008826567157056875,0.009857846875942045,0.00990065808381857,0.010094726314467728,0.010802860730015684,0.011245437893018906,0.011265605726030525,0.011713964784503261,0.011947606789813658,0.012121516237049601,0.012305044678708299,0.01245194217744583,0.013068078405757522,0.013794101549347904,0.013992420949084039,0.01406420984204404,0.015188414796511118,0.015329564676268781,0.01590266636470883,0.017881892693653256,0.017940522943062476,0.019392172102906446,0.019671848347037724,0.021598638810849558,0.02163011990007968,0.021992223537621314,0.02361462785482571,0.023788650328773198,0.023886885644101685,0.02393317065922096,0.024058392960949693,0.024269710780469023,0.02433284250433765,0.02508373496275329,0.026341229026108692,0.026568456802207763,0.026722806474062555,0.02677426310208375,0.026865196912173595,0.027311283943552755,0.027488219690274818,0.027832273879464964,0.027991136190447463,0.028637106543989876,0.029236289196262977,0.029546855117406956,0.029686201542153068,0.03008822560468616,0.030485105990567085,0.030836473930842434,0.03137981276006574,0.032142670446442256,0.032840271042786195,0.0340057946541652,0.03440711794185214,0.03513631422554564,0.03517314059594767,0.035220161361367186,0.03606343737808526,0.0362092424345426,0.03633083404871895,0.0365701421189768,0.03665595565999791,0.03669295869445355,0.03807338367894397,0.0381767945328324,0.038177182753032834,0.03878302355324914,0.03906658057896406,0.03949043143405895,0.04001308795649017,0.04006262184639331,0.040324989366145036,0.040510686848650224,0.04095783970180422,0.04116743955934288,0.043869201388672785,0.04443748592727648,0.04515801900158012,0.04617373170137551,0.04722860127722761,0.0475508961737523,0.04776576547102751,0.04795504101096837,0.048633815035796335,0.04901213579129848,0.049345549208793305,0.04938066944308783,0.0507327614678319,0.05079154078271442,0.05260888185752366,0.05428891914839484,0.05451486165808772,0.0550830881367359,0.05515231963901002,0.05583282216142571,0.055836463737202635,0.05695122034786548,0.057057892045264236,0.05729243660476957,0.05887085732430686,0.05984425150964556,0.05991973552453134,0.060398225051879084,0.062142734434061264,0.06264025719520738,0.06337841595608484,0.06422900528293285,0.06445541238646957,0.06521265506712748,0.06578969647290611,0.06630674362280331,0.06665942040388728,0.06694699128690784,0.06721602786665892,0.0678330762676671,0.06801868320113202,0.06862495228783994,0.06876395462725293,0.06895896771912557,0.06913548542664372,0.06913723154433304,0.06930931439918231,0.06972328401902539,0.07075753265274498,0.07076068653165679,0.07101639047139052,0.07106933378421276,0.07109643014280964,0.07174477287972625,0.07202464179077683,0.07375127127836567,0.07402263243464802,0.07455896680911245,0.0759669189725547,0.07624704036076801,0.07672740937683686,0.07720766503153165,0.0788579349372811,0.07976998088398712,0.07995505753485155,0.08014034576333007,0.08016027047360375,0.08071447600565973,0.08073465392402746,0.08155931800938321,0.08157114064405002,0.08182124771415067,0.08188293683639136,0.08341612634470197,0.08352251743640426,0.0838578546292501,0.08439441214702859,0.08584732614651491,0.08617875612115578,0.08620565185132634,0.08751639868413141,0.08787749437097858,0.08970690209487797,0.09015178459833617,0.09094825362034076,0.09096473393465399,0.0910406740199643,0.0922188778553128,0.09229322393608674,0.09339377688189243,0.09437996731958531,0.09455817142641365,0.09467422598538766,0.09485858037118833,0.09508402512121616,0.09536918966339236,0.0959720360398113,0.09601782255072022,0.09673229212445911,0.09762750898354833,0.09845472781639009,0.09875987395934605,0.09946242346265777,0.09993570389140594,0.10086057621380506,0.10152600366414921,0.10170140953835638,0.10314627382698793,0.10427829604306593,0.10517674638477414,0.10576800725245894,0.10735967242302324,0.10761912830267084,0.10780817712755475,0.10822786197381129,0.10915079688322438,0.10923536389650534,0.11037416204613981,0.11106039373314358,0.11137112317928954,0.11167752740900849,0.11207828094456085,0.11210399967708984,0.11533435343429188,0.115408696859304,0.1170524029917761,0.11869679038377545,0.11889946585370836,0.12104327413619398,0.12104895245164382,0.12104923364210496,0.12124873884601506,0.12165238428176384,0.1220209739763276,0.12217549576645093,0.12255113942018703,0.12328332774362627,0.12387679610565083,0.12391595450945792,0.12393232993868475,0.12441464513512113,0.1274168641346738,0.1278318382161081,0.12879963114577953,0.12883544794980883,0.12910484845343229,0.1291333071989924,0.13168953566298347,0.13256587176560597,0.13290294482681286,0.13321457440502238,0.13431139922258728,0.13437215608302155,0.1348143367627066,0.13602844559136829,0.13613667258858797,0.13661838769383738,0.13715449289360349,0.13719473039309937,0.13794555924665097,0.13797776653552551,0.13901843655565704,0.1391498636840809,0.1408741198717296,0.14139331357496587,0.14166764172144397,0.14237046820140664,0.14255128172371911,0.1440295448400124,0.14406679263573885,0.1445108148878287,0.14520718755949025,0.14532465334496125,0.1462234736372019,0.14706767507199459,0.14783936237381212,0.14844735105376783,0.14852833684210553,0.14873098768676662,0.1487623632608268,0.14942613244208225,0.14943013205519362,0.14948638362723443,0.1502115341693373,0.1505017782175435,0.15113261223616492,0.15140056719731865,0.15223502216852447,0.153327490585359,0.15390781879632698,0.1542589109457495,0.15465742485336076,0.15528938588587193,0.15562198999782506,0.15574825501099854,0.15623097242013073,0.15797187307971838,0.15863560043451486,0.15914618632775257,0.1592045412859897,0.15980798878432756,0.16118552401256458,0.16120874496409554,0.16161087787814177,0.16282309258263616,0.16292789299091348,0.16333768582592834,0.16335556382875716,0.16581188931844792,0.16613849759403987,0.16678728888990424,0.16745348058531428,0.168273298374209,0.16850711458067158,0.16991353278219679,0.1703558420797897,0.17099814048070394,0.17284934573472377,0.17285426000660253,0.17301930510975616,0.17303598386419106,0.1735272290700669,0.1736577346275694,0.17569200042662692,0.17595385412722298,0.17746957598874769,0.17779598829747068,0.1783434418612635,0.1783564236475743,0.17886614363722453,0.1792743792917424,0.1795555673141167,0.18008362759262342,0.18021751895934512,0.18072578336143774,0.18158121643412395,0.1823183283076193,0.1826284514009422,0.18305812649653497,0.18408378620452615,0.1845785816142249,0.18523356531940216,0.18620046854063732,0.18643191844310802,0.1870241419436267,0.18721788888560642,0.18729404863816956,0.18768357675461278,0.18881055449151907,0.18916991506537784,0.18952415189893168,0.18956721632403495,0.19037475471233734,0.1905182294578922,0.1918489931686782,0.19214083422299266,0.19224052719197937,0.1932494721432465,0.19405606203760684,0.19506374740841048,0.19552286573627975,0.19689696446309446,0.19715585137110603,0.19804163249484485,0.1994952117634914,0.20001102274084426,0.20180558132521798,0.20189642444213662,0.20263356343360606,0.2039707729983209,0.20419236490833148,0.20457473443464558,0.20583131654459264,0.20595860019422352,0.20750601683143444,0.2075883482130907,0.20766518195770844,0.2081872443809909,0.20837983779233005,0.20879419411845657,0.20913274763386092,0.2099089091097066,0.21015523779042633,0.21037839671740333,0.21203436634608552,0.21252451662056826,0.21365937619146003,0.21390382083050774,0.21401964410352026,0.2153168815380444,0.21576847461626159,0.2163617010720118,0.21669085517584952,0.21692191069014966,0.2172278852938221,0.21743979439641015,0.2178675879674472,0.21860999766274425,0.21872753707737713,0.21946718787357522,0.22023238263511802,0.22040720804636038,0.22080642107939719,0.22246800941377431,0.22368314248070353,0.22462123583219773,0.22482183913230225,0.22498559971473497,0.22525948027841602,0.22725450527666036,0.22738701774023662,0.22789139456690677,0.22941033271202071,0.23004654587963103,0.23049568255183717,0.23106321763926907,0.23293349883160896,0.2341895872943618,0.23531939959744586,0.23558716561124626,0.23739144545420343,0.23746818929338964,0.2376763766496146,0.23844849195701912,0.23973266917199876,0.24015755915968695,0.2405750403908984,0.24162379719551996,0.24264348110795853,0.24273197736018615,0.2428008244778912,0.24332998741558942,0.24437272383137554,0.24474752133609545,0.2466555952405951,0.24696895133285812,0.24761937921787958,0.24792471804508454,0.2484489105983192,0.2486346003739901,0.24873641434011873,0.24890129936216532,0.25061046879783966,0.25145567653695045,0.25551901916826525,0.25618457368063785,0.258741823542723,0.258877818375459,0.2596853109020727,0.26036943473626906,0.26099765027070854,0.26165785267066344,0.26197608262757877,0.26260893158746024,0.2632614367231021,0.26381577958307956,0.2641603048531276,0.2646934682422559,0.26516744026778927,0.2652822269437305,0.2672859671789549,0.2673790276318124,0.27030851262493627,0.27059011177851255,0.271393221179105,0.2716287028533477,0.2736483835269845,0.2741946513872442,0.2748486752707566,0.27506926047296787,0.27607924215180013,0.27613856109653456,0.27617887410386066,0.2776628265110994,0.2780269551108834,0.2782955236705895,0.2788042463606155,0.28135189269404925,0.28145717642512613,0.2814934378036713,0.28291845350317946,0.2831871801644623,0.28465029917757656,0.2850681218162423,0.2850718403600303,0.2864363967629937,0.28728119153916865,0.2899114232131157,0.2899461283164393,0.2901882993021614,0.29110213148639863,0.29115701406126027,0.2918528638468141,0.2926733148643601,0.2951078099544038,0.29609633007574265,0.29626065474121654,0.29989365601730933,0.30005085853470614,0.30011433795156783,0.30124562766956453,0.30148310737524975,0.301659180374255,0.30190456207145866,0.30200820111117865,0.30367419174304455,0.30373643735279376,0.30425914453197445,0.3059782173504968,0.30624380611239355,0.30705783073183524,0.30763044937251993,0.30764486472868136,0.308160849458055,0.3082290401726895,0.30830252361045574,0.3087201016057577,0.30907885820855574,0.30935862246549806,0.30982140546235204,0.3100357258324977,0.31040275314896304,0.3104490357623577,0.31096527516127814,0.3159607072568811,0.31640065672400386,0.3174927705695789,0.3184582102274258,0.31859117186739816,0.3188593022842352,0.3245210967460661,0.3293055182919935,0.32985827468573614,0.32989185436944,0.330409528703298,0.3315642518245894,0.3318663322646547,0.33202951426242455,0.33332362461678056,0.3353713924723847,0.33842895580725063,0.3393429521151652,0.34166613562045844,0.3417848079087831,0.34259719089152574,0.3462353937932088,0.34755332126207916,0.3483980401005291,0.34942864665511264,0.3520924260344005,0.3548265163283939,0.3586131219812292,0.3598333652891319,0.3600699606909905,0.36130010657841716,0.36269112565246076,0.3636799932496806,0.36658550975280635,0.36662010247170684,0.3676841720237798,0.3678508345271476,0.3691003878772787,0.37149959491919127,0.3723042810293564,0.3728403980349402,0.37300675808903705,0.37484856649536535,0.3750178476518484,0.3750270991241864,0.3772231489197826,0.37769187140063254,0.37794088645285395,0.38188883886418035,0.382746472862987,0.3830733003078608,0.38379903255567793,0.38671753182513235,0.3871696557544877,0.388457609084107,0.39199038745876447,0.39389174128786353,0.39423952672606477,0.3942684510055323,0.3956674623345644,0.39660774014085254,0.39985378375529335,0.4014810746372226,0.4032318109367563,0.4035296144987899,0.40530978461422595,0.4057793899597697,0.4066115821969567,0.4077936888138667,0.40870849827257105,0.408820561111372,0.41039851678628914,0.41222751309750905,0.41416412973899996,0.4160438105184645,0.4162156049564105,0.4165501092718309,0.4209785284542682,0.421135227646237,0.4217272524137168,0.426485912137168,0.42679919787332965,0.42902415145085504,0.43171291047169413,0.43201427641085166,0.43331461147119166,0.4336259036889829,0.43539905927396605,0.4364854611441884,0.43656302124234214,0.4367547102746041,0.4386953290543716,0.4392119339813876,0.4402877762006421,0.4413130390012925,0.441412116413058,0.44191822147721194,0.4426195255275194,0.4457260965609038,0.4457550263956116,0.4470419196617814,0.4478788051569853,0.4483229819843815,0.4495863191121505,0.45040403007890006,0.4516294747935379,0.4534148235549593,0.45346348991289487,0.45612542594162786,0.4561893418632006,0.45918049143979855,0.4593931338893964,0.4598588967750241,0.4612655007677695,0.46147330192073266,0.4635845774777756,0.46457261726424326,0.4664781942819398,0.4688983331756553,0.46919502334199015,0.4708944577294383,0.47122629697422225,0.47691043252867305,0.47705526865085535,0.4772812924175889,0.4773925304802642,0.4787618197568144,0.47906366051198335,0.4806134930119006,0.4849823062294898,0.4860566851800394,0.4864059334499342,0.4866480606224557,0.4874875816942472,0.48793684932260684,0.4911810773000336,0.49155062432918273,0.4919029696920276,0.4929444600701536,0.4950778137012515,0.49734231493809045,0.5000086363930514,0.5001145773331084,0.501600332482425,0.5089983038244985,0.5090399809583221,0.5122030632481138,0.514320507774233,0.5151707309363647,0.5206652641425946,0.5208737252039142,0.5249546595448344,0.5265303900121432,0.5270720283873733,0.5316448565102001,0.5342918833866075,0.5343138494929982,0.5366764474419679,0.5398010807983646,0.5418018100811075,0.5422962735818295,0.5438542966638082,0.5451772817099623,0.5474520019358406,0.5488312911138844,0.5509508719946727,0.5560855544238597,0.560455209250414,0.5650374512413134,0.5684595320523314,0.5717444510362721,0.5736904624149735,0.575979187775568,0.5761017419749375,0.5762904127056676,0.5863299070971499,0.5863813862138851,0.5868178804781161,0.58681972255786,0.5909929463225967,0.592544337195057,0.5949382425600533,0.6047395476831445,0.6077919109607848,0.6093762515790162,0.6164854196337557,0.6189592524421097,0.620852205353954,0.6247972438899381,0.6249646579697765,0.6276280895027408,0.6280126235648833,0.6340522602642502,0.6352352951111815,0.641138241008153,0.6431217913768053,0.6492653509080819,0.6502562663851243,0.6512724338284941,0.6528717440731338,0.6662678548444068,0.6680327696040824,0.6695190126562265,0.673637654620713,0.6849684702446184,0.701771688854163,0.704597249163982,0.7106867613571723,0.7246633335867276,0.7247032697044178,0.7361466166703705,0.7414256457322135,0.7497928476802507,0.7589159986082801,0.7722068591339055,0.7738315750447349,0.780053848298532,0.7946210380797387,0.7960367405966493,0.8005780985992228,0.8414975457255469,0.8449123750582572,0.8529816168274424,0.8547783819188206,0.8592283699707988,0.8706481093322385,0.8956771920984092,1.016582363930175,1.0223032886165244,1.0718044603118786],"y":[0.9986666666666667,0.9973333333333333,0.996,0.9946666666666667,0.9933333333333333,0.992,0.9906666666666667,0.9893333333333333,0.988,0.9866666666666667,0.9853333333333333,0.984,0.9826666666666667,0.9813333333333333,0.98,0.9786666666666667,0.9773333333333334,0.976,0.9746666666666667,0.9733333333333334,0.972,0.9706666666666667,0.9693333333333334,0.968,0.9666666666666667,0.9653333333333334,0.964,0.9626666666666667,0.9613333333333334,0.96,0.9586666666666667,0.9573333333333334,0.956,0.9546666666666667,0.9533333333333334,0.952,0.9506666666666667,0.9493333333333334,0.948,0.9466666666666667,0.9453333333333334,0.944,0.9426666666666667,0.9413333333333334,0.94,0.9386666666666666,0.9373333333333334,0.9359999999999999,0.9346666666666666,0.9333333333333333,0.9319999999999999,0.9306666666666666,0.9293333333333333,0.928,0.9266666666666666,0.9253333333333333,0.924,0.9226666666666666,0.9213333333333333,0.92,0.9186666666666666,0.9173333333333333,0.916,0.9146666666666666,0.9133333333333333,0.912,0.9106666666666666,0.9093333333333333,0.908,0.9066666666666666,0.9053333333333333,0.904,0.9026666666666667,0.9013333333333333,0.9,0.8986666666666667,0.8973333333333333,0.896,0.8946666666666667,0.8933333333333333,0.892,0.8906666666666667,0.8893333333333333,0.888,0.8866666666666667,0.8853333333333333,0.884,0.8826666666666667,0.8813333333333333,0.88,0.8786666666666667,0.8773333333333333,0.876,0.8746666666666667,0.8733333333333333,0.872,0.8706666666666667,0.8693333333333333,0.868,0.8666666666666667,0.8653333333333333,0.864,0.8626666666666667,0.8613333333333333,0.86,0.8586666666666667,0.8573333333333333,0.856,0.8546666666666667,0.8533333333333333,0.852,0.8506666666666667,0.8493333333333333,0.848,0.8466666666666667,0.8453333333333333,0.844,0.8426666666666667,0.8413333333333333,0.84,0.8386666666666667,0.8373333333333334,0.836,0.8346666666666667,0.8333333333333334,0.832,0.8306666666666667,0.8293333333333334,0.8280000000000001,0.8266666666666667,0.8253333333333334,0.8240000000000001,0.8226666666666667,0.8213333333333334,0.8200000000000001,0.8186666666666667,0.8173333333333334,0.8160000000000001,0.8146666666666667,0.8133333333333334,0.812,0.8106666666666666,0.8093333333333333,0.808,0.8066666666666666,0.8053333333333333,0.804,0.8026666666666666,0.8013333333333333,0.8,0.7986666666666666,0.7973333333333333,0.796,0.7946666666666666,0.7933333333333333,0.792,0.7906666666666666,0.7893333333333333,0.788,0.7866666666666666,0.7853333333333333,0.784,0.7826666666666666,0.7813333333333333,0.78,0.7786666666666666,0.7773333333333333,0.776,0.7746666666666666,0.7733333333333333,0.772,0.7706666666666666,0.7693333333333333,0.768,0.7666666666666666,0.7653333333333333,0.764,0.7626666666666666,0.7613333333333333,0.76,0.7586666666666666,0.7573333333333333,0.756,0.7546666666666667,0.7533333333333333,0.752,0.7506666666666667,0.7493333333333334,0.748,0.7466666666666666,0.7453333333333334,0.744,0.7426666666666666,0.7413333333333334,0.74,0.7386666666666667,0.7373333333333334,0.736,0.7346666666666667,0.7333333333333334,0.732,0.7306666666666667,0.7293333333333334,0.728,0.7266666666666667,0.7253333333333334,0.724,0.7226666666666667,0.7213333333333334,0.72,0.7186666666666667,0.7173333333333334,0.716,0.7146666666666667,0.7133333333333334,0.712,0.7106666666666667,0.7093333333333334,0.708,0.7066666666666667,0.7053333333333334,0.704,0.7026666666666667,0.7013333333333334,0.7,0.6986666666666667,0.6973333333333334,0.696,0.6946666666666667,0.6933333333333334,0.692,0.6906666666666667,0.6893333333333334,0.688,0.6866666666666666,0.6853333333333333,0.6839999999999999,0.6826666666666666,0.6813333333333333,0.6799999999999999,0.6786666666666666,0.6773333333333333,0.6759999999999999,0.6746666666666667,0.6733333333333333,0.6719999999999999,0.6706666666666667,0.6693333333333333,0.6679999999999999,0.6666666666666667,0.6653333333333333,0.6639999999999999,0.6626666666666667,0.6613333333333333,0.6599999999999999,0.6586666666666667,0.6573333333333333,0.656,0.6546666666666667,0.6533333333333333,0.652,0.6506666666666667,0.6493333333333333,0.648,0.6466666666666667,0.6453333333333333,0.644,0.6426666666666667,0.6413333333333333,0.64,0.6386666666666667,0.6373333333333333,0.636,0.6346666666666667,0.6333333333333333,0.632,0.6306666666666667,0.6293333333333333,0.628,0.6266666666666667,0.6253333333333333,0.624,0.6226666666666667,0.6213333333333333,0.62,0.6186666666666667,0.6173333333333333,0.616,0.6146666666666667,0.6133333333333333,0.612,0.6106666666666667,0.6093333333333333,0.608,0.6066666666666667,0.6053333333333333,0.604,0.6026666666666667,0.6013333333333333,0.6,0.5986666666666667,0.5973333333333333,0.596,0.5946666666666667,0.5933333333333333,0.5920000000000001,0.5906666666666667,0.5893333333333333,0.5880000000000001,0.5866666666666667,0.5853333333333333,0.5840000000000001,0.5826666666666667,0.5813333333333333,0.5800000000000001,0.5786666666666667,0.5773333333333333,0.5760000000000001,0.5746666666666667,0.5733333333333333,0.5720000000000001,0.5706666666666667,0.5693333333333334,0.5680000000000001,0.5666666666666667,0.5653333333333334,0.5640000000000001,0.5626666666666666,0.5613333333333334,0.56,0.5586666666666666,0.5573333333333333,0.556,0.5546666666666666,0.5533333333333333,0.552,0.5506666666666666,0.5493333333333333,0.548,0.5466666666666666,0.5453333333333333,0.544,0.5426666666666666,0.5413333333333333,0.54,0.5386666666666666,0.5373333333333333,0.536,0.5346666666666666,0.5333333333333333,0.532,0.5306666666666666,0.5293333333333333,0.528,0.5266666666666666,0.5253333333333333,0.524,0.5226666666666666,0.5213333333333333,0.52,0.5186666666666666,0.5173333333333333,0.516,0.5146666666666666,0.5133333333333333,0.512,0.5106666666666666,0.5093333333333334,0.508,0.5066666666666666,0.5053333333333334,0.504,0.5026666666666666,0.5013333333333334,0.5,0.4986666666666667,0.4973333333333333,0.496,0.4946666666666667,0.4933333333333333,0.492,0.4906666666666667,0.4893333333333333,0.488,0.4866666666666667,0.4853333333333333,0.484,0.4826666666666667,0.4813333333333333,0.48,0.4786666666666667,0.4773333333333334,0.476,0.4746666666666667,0.4733333333333334,0.472,0.4706666666666667,0.4693333333333334,0.46799999999999997,0.4666666666666667,0.4653333333333334,0.46399999999999997,0.46266666666666667,0.4613333333333334,0.45999999999999996,0.45866666666666667,0.45733333333333337,0.45599999999999996,0.45466666666666666,0.45333333333333337,0.45199999999999996,0.45066666666666666,0.44933333333333336,0.44799999999999995,0.44666666666666666,0.44533333333333336,0.44399999999999995,0.44266666666666665,0.44133333333333336,0.43999999999999995,0.43866666666666665,0.43733333333333335,0.43600000000000005,0.43466666666666665,0.43333333333333335,0.43200000000000005,0.43066666666666664,0.42933333333333334,0.42800000000000005,0.42666666666666664,0.42533333333333334,0.42400000000000004,0.42266666666666663,0.42133333333333334,0.42000000000000004,0.41866666666666663,0.41733333333333333,0.41600000000000004,0.41466666666666663,0.41333333333333333,0.41200000000000003,0.4106666666666666,0.4093333333333333,0.40800000000000003,0.4066666666666666,0.4053333333333333,0.404,0.4026666666666666,0.4013333333333333,0.4,0.3986666666666666,0.3973333333333333,0.396,0.3946666666666667,0.3933333333333333,0.392,0.3906666666666667,0.3893333333333333,0.388,0.3866666666666667,0.3853333333333333,0.384,0.3826666666666667,0.3813333333333333,0.38,0.3786666666666667,0.3773333333333333,0.376,0.3746666666666667,0.3733333333333333,0.372,0.3706666666666667,0.3693333333333333,0.368,0.3666666666666667,0.3653333333333333,0.364,0.3626666666666667,0.3613333333333333,0.36,0.3586666666666667,0.3573333333333333,0.356,0.3546666666666667,0.3533333333333334,0.352,0.3506666666666667,0.3493333333333334,0.348,0.3466666666666667,0.3453333333333334,0.344,0.3426666666666667,0.3413333333333334,0.33999999999999997,0.33866666666666667,0.3373333333333334,0.33599999999999997,0.33466666666666667,0.33333333333333337,0.33199999999999996,0.33066666666666666,0.32933333333333337,0.32799999999999996,0.32666666666666666,0.32533333333333336,0.32399999999999995,0.32266666666666666,0.32133333333333336,0.31999999999999995,0.31866666666666665,0.31733333333333336,0.31599999999999995,0.31466666666666665,0.31333333333333335,0.31200000000000006,0.31066666666666665,0.30933333333333335,0.30800000000000005,0.30666666666666664,0.30533333333333335,0.30400000000000005,0.30266666666666664,0.30133333333333334,0.30000000000000004,0.29866666666666664,0.29733333333333334,0.29600000000000004,0.29466666666666663,0.29333333333333333,0.29200000000000004,0.29066666666666663,0.28933333333333333,0.28800000000000003,0.2866666666666666,0.2853333333333333,0.28400000000000003,0.2826666666666666,0.2813333333333333,0.28,0.2786666666666666,0.2773333333333333,0.276,0.2746666666666666,0.2733333333333333,0.272,0.2706666666666667,0.2693333333333333,0.268,0.2666666666666667,0.2653333333333333,0.264,0.2626666666666667,0.2613333333333333,0.26,0.2586666666666667,0.2573333333333333,0.256,0.2546666666666667,0.2533333333333333,0.252,0.2506666666666667,0.2493333333333333,0.248,0.2466666666666667,0.2453333333333333,0.244,0.2426666666666667,0.2413333333333333,0.24,0.2386666666666667,0.23733333333333329,0.236,0.2346666666666667,0.23333333333333328,0.23199999999999998,0.2306666666666667,0.22933333333333328,0.22799999999999998,0.22666666666666668,0.22533333333333339,0.22399999999999998,0.22266666666666668,0.22133333333333338,0.21999999999999997,0.21866666666666668,0.21733333333333338,0.21599999999999997,0.21466666666666667,0.21333333333333337,0.21199999999999997,0.21066666666666667,0.20933333333333337,0.20799999999999996,0.20666666666666667,0.20533333333333337,0.20399999999999996,0.20266666666666666,0.20133333333333336,0.19999999999999996,0.19866666666666666,0.19733333333333336,0.19599999999999995,0.19466666666666665,0.19333333333333336,0.19199999999999995,0.19066666666666665,0.18933333333333335,0.18799999999999994,0.18666666666666665,0.18533333333333335,0.18400000000000005,0.18266666666666664,0.18133333333333335,0.18000000000000005,0.17866666666666664,0.17733333333333334,0.17600000000000005,0.17466666666666664,0.17333333333333334,0.17200000000000004,0.17066666666666663,0.16933333333333334,0.16800000000000004,0.16666666666666663,0.16533333333333333,0.16400000000000003,0.16266666666666663,0.16133333333333333,0.16000000000000003,0.15866666666666662,0.15733333333333333,0.15600000000000003,0.15466666666666662,0.15333333333333332,0.15200000000000002,0.15066666666666662,0.14933333333333332,0.14800000000000002,0.1466666666666666,0.14533333333333331,0.14400000000000002,0.14266666666666672,0.1413333333333333,0.14,0.13866666666666672,0.1373333333333333,0.136,0.1346666666666667,0.1333333333333333,0.132,0.1306666666666667,0.1293333333333333,0.128,0.1266666666666667,0.1253333333333333,0.124,0.1226666666666667,0.1213333333333333,0.12,0.1186666666666667,0.11733333333333329,0.11599999999999999,0.1146666666666667,0.11333333333333329,0.11199999999999999,0.11066666666666669,0.10933333333333328,0.10799999999999998,0.10666666666666669,0.10533333333333328,0.10399999999999998,0.10266666666666668,0.10133333333333339,0.09999999999999998,0.09866666666666668,0.09733333333333338,0.09599999999999997,0.09466666666666668,0.09333333333333338,0.09199999999999997,0.09066666666666667,0.08933333333333338,0.08799999999999997,0.08666666666666667,0.08533333333333337,0.08399999999999996,0.08266666666666667,0.08133333333333337,0.07999999999999996,0.07866666666666666,0.07733333333333337,0.07599999999999996,0.07466666666666666,0.07333333333333336,0.07199999999999995,0.07066666666666666,0.06933333333333336,0.06799999999999995,0.06666666666666665,0.06533333333333335,0.06399999999999995,0.06266666666666665,0.06133333333333335,0.06000000000000005,0.058666666666666645,0.05733333333333335,0.05600000000000005,0.05466666666666664,0.053333333333333344,0.052000000000000046,0.05066666666666664,0.04933333333333334,0.04800000000000004,0.046666666666666634,0.04533333333333334,0.04400000000000004,0.04266666666666663,0.04133333333333333,0.040000000000000036,0.03866666666666663,0.03733333333333333,0.03600000000000003,0.03466666666666662,0.033333333333333326,0.03200000000000003,0.03066666666666662,0.029333333333333322,0.028000000000000025,0.026666666666666616,0.02533333333333332,0.02400000000000002,0.022666666666666613,0.021333333333333315,0.020000000000000018,0.01866666666666672,0.01733333333333331,0.016000000000000014,0.014666666666666717,0.013333333333333308,0.01200000000000001,0.010666666666666713,0.009333333333333305,0.008000000000000007,0.00666666666666671,0.005333333333333301,0.0040000000000000036,0.002666666666666706,0.0013333333333332975,0.0],"type":"scatter"}],                        {"template":{"data":{"scatter":[{"type":"scatter"}]}},"yaxis":{"type":"linear","gridwidth":2,"zeroline":false,"automargin":true,"ticks":"outside","tickcolor":"white","ticklen":10,"fixedrange":true,"tickformat":",.0%"},"xaxis":{"title":{"text":"|residual|"},"type":"linear","gridwidth":2,"zeroline":false,"automargin":true,"ticks":"outside","tickcolor":"white","ticklen":10,"fixedrange":true},"title":{"text":"Reverse cumulative distribution of |residual|","x":0.15},"font":{"color":"#371ea3"},"margin":{"t":78,"b":71,"r":30}},                        {"responsive": true}                    )                };                            </script>        </div>
<figcaption class="figure-caption">Figure&nbsp;3.2: Python Performance Plot</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>We can see what R and Python offer us for model performance plots in <a href="#fig-r_perf-plot" class="quarto-xref">Figure&nbsp;<span>3.1</span></a> and <a href="#fig-py_perf-plot" class="quarto-xref">Figure&nbsp;<span>3.2</span></a>. We can dig into more specific information about our model, beyond just the general performance.</p>
<section id="variable-importance" class="level4" data-number="3.3.1.1">
<h4 data-number="3.3.1.1" class="anchored" data-anchor-id="variable-importance"><span class="header-section-number">3.3.1.1</span> Variable Importance</h4>
<p>As with any model, knowing which variables are important is a critical piece of information. We can use the <code>model_parts</code> function to get a sense of which variables are most important to our model. Dalex creates feature importance by assessing how a model’s RMSE changes when a feature is permuted. The more the loss changes, the more important the feature!</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-19-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-1" role="tab" aria-controls="tabset-19-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-19-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-2" role="tab" aria-controls="tabset-19-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-19-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-19-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>model_var_imp <span class="ot">=</span> <span class="fu">model_parts</span>(</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  train_explain, <span class="at">type =</span> <span class="st">"variable_importance"</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_var_imp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-r_var-imp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="model_criticism_files/figure-html/fig-r_var-imp-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3.3: R Variable Importance Plot</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-19-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-19-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>model_var_imp <span class="op">=</span> train_explain.model_parts(</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">type</span> <span class="op">=</span> <span class="st">"variable_importance"</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>model_var_imp.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>TODO: ONLY SHOW ONE PRETTY PLOT, BUT ALLOW THE CODE TO SHOW HOW TO OBTAIN</p>
<p>In <a href="#fig-r_var-imp" class="quarto-xref">Figure&nbsp;<span>3.3</span></a> and <span class="quarto-unresolved-ref">?fig-py_var-imp</span>, we see that <code>total_reviews_sc</code>, <code>length_minutes_sc</code>, <code>word_count_sc</code>, and <code>release_year_0</code> are the most important features in our model. Now that we know the variables that are pulling the most weight, we can turn to exploring predictions.</p>
</section>
<section id="localized-predictions" class="level4" data-number="3.3.1.2">
<h4 data-number="3.3.1.2" class="anchored" data-anchor-id="localized-predictions"><span class="header-section-number">3.3.1.2</span> Localized Predictions</h4>
<p>If you are every curious to see how a particular observation reached its predicted value, you can use the <code>predict_parts</code> function to get a sense of how each feature contributed to the final prediction. We will look at the second observation in our testing_data to see how it was predicted.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-20-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-1" role="tab" aria-controls="tabset-20-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-20-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-2" role="tab" aria-controls="tabset-20-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-20-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-20-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>break_down_plot <span class="ot">=</span> <span class="fu">predict_parts</span>(</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  train_explain, </span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">new_observation =</span> testing_data[<span class="dv">2</span>, ], </span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"break_down"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(break_down_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-r_break-down" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="model_criticism_files/figure-html/fig-r_break-down-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3.4: R Break Down Plot</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-20-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-20-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>break_down_plot <span class="op">=</span> train_explain.predict_parts(</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>    new_observation <span class="op">=</span> X_features_testing[<span class="dv">1</span>],</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">type</span> <span class="op">=</span> <span class="st">"break_down"</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>break_down_plot.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>The Break down plots in <a href="#fig-r_break-down" class="quarto-xref">Figure&nbsp;<span>3.4</span></a> and <span class="quarto-unresolved-ref">?fig-py_break-down</span> show us how each feature contributed to the final prediction for an observation. If a prediction from a model has ever surprised you, this is a great way to see how that prediction actually happened!</p>
</section>
<section id="shap-plots" class="level4" data-number="3.3.1.3">
<h4 data-number="3.3.1.3" class="anchored" data-anchor-id="shap-plots"><span class="header-section-number">3.3.1.3</span> Shap Plots</h4>
<p><strong>Shapley values</strong> are a way to explain the predictions made by machine learning models. They break down a prediction to show the impact of each feature. The Shapley value was originally developed in game theory to determine how much each player in a cooperative game has contributed to the total payoff of the game. You’ll commonly see them used in conjunction with tree-based models, like xgboost, but they can be used with any model.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-21-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-1" role="tab" aria-controls="tabset-21-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-21-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-2" role="tab" aria-controls="tabset-21-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-21-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-21-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>shap_plot <span class="ot">=</span> <span class="fu">predict_parts</span>(</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  train_explain, </span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">new_observation =</span> testing_data, </span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"shap"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(shap_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-r_shap" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="model_criticism_files/figure-html/fig-r_shap-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3.5: R Shap Plot</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-21-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-21-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>shap_plot <span class="op">=</span> train_explain.predict_parts(</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>    new_observation <span class="op">=</span> X_features_testing[<span class="dv">1</span>], </span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">type</span> <span class="op">=</span> <span class="st">"shap"</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>shap_plot.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>The Shap plots in <a href="#fig-r_shap" class="quarto-xref">Figure&nbsp;<span>3.5</span></a> and <span class="quarto-unresolved-ref">?fig-py_shap</span> show us how each feature contributed to the final prediction for an observation.</p>
</section>
</section>
<section id="classification" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="classification"><span class="header-section-number">3.3.2</span> Classification</h3>
<p>The set-up and functions are exactly the same for classification models, so we want to show you how we can also incorporate information from categorical variables into our explainers.</p>
<p>We’ll create our explainer and then look at the <strong>Partial Dependence Plots</strong> for our model, but broken down by <code>genre</code>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-22-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-1" role="tab" aria-controls="tabset-22-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-22-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-2" role="tab" aria-controls="tabset-22-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-22-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-22-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>train_explain <span class="ot">=</span> <span class="fu">explain</span>(</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  logistic_model_train, </span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> training_data[, features], </span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> training_data<span class="sc">$</span>rating_good,</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>train_performance <span class="ot">=</span> <span class="fu">model_performance</span>(train_explain)</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a><span class="co"># train_performance # not shown</span></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>partial_model_profile <span class="ot">=</span> <span class="fu">model_profile</span>(train_explain, </span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>                                  features, </span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">groups =</span> <span class="st">"genre"</span>,</span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">type =</span> <span class="st">"partial"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(partial_model_profile)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-r_partial-plot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="model_criticism_files/figure-html/fig-r_partial-plot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3.6: R Partial Dependence Plot by Genre</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-22-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-22-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>train_explain <span class="op">=</span> dx.Explainer(</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>    logistic_model_train, </span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> X_features, </span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> training_data.rating_good, </span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>    verbose <span class="op">=</span> <span class="va">False</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>train_performance <span class="op">=</span> train_explain.model_performance()</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>partial_model_profile <span class="op">=</span> train_explain.model_profile(</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">type</span> <span class="op">=</span> <span class="st">"partial"</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Calculating ceteris paribus:   0%|          | 0/25 [00:00&lt;?, ?it/s]
Calculating ceteris paribus: 100%|##########| 25/25 [00:00&lt;00:00, 371.01it/s]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>partial_model_profile.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>We can see what R and Python offer us for partial dependence plots in <a href="#fig-r_partial-plot" class="quarto-xref">Figure&nbsp;<span>3.6</span></a> and <span class="quarto-unresolved-ref">?fig-py_partial-plot</span>. In <a href="#fig-r_partial-plot" class="quarto-xref">Figure&nbsp;<span>3.6</span></a>, we see those are broken down by the different genres, allowing us to see the differences between genres.</p>
<section id="variable-importance-1" class="level4" data-number="3.3.2.1">
<h4 data-number="3.3.2.1" class="anchored" data-anchor-id="variable-importance-1"><span class="header-section-number">3.3.2.1</span> Variable Importance</h4>
<p>We can also look at the variable importance for our classification model. While it operates on the same principle of the regression model, variable importance for classification models is calculated by assessing how a model’s AUC changes when a feature is permuted, as opposed to RMSE.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-23-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-1" role="tab" aria-controls="tabset-23-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-23-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-2" role="tab" aria-controls="tabset-23-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-23-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-23-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>model_var_imp <span class="ot">=</span> <span class="fu">model_parts</span>(train_explain, <span class="at">type =</span> <span class="st">"variable_importance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_var_imp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-r_var-imp-class" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="model_criticism_files/figure-html/fig-r_var-imp-class-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3.7: R Variable Importance Plot for Classification</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-23-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-23-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>model_var_imp <span class="op">=</span> train_explain.model_parts(</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">type</span> <span class="op">=</span> <span class="st">"variable_importance"</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>model_var_imp.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>The variable importance plots in <a href="#fig-r_var-imp-class" class="quarto-xref">Figure&nbsp;<span>3.7</span></a> and <span class="quarto-unresolved-ref">?fig-py_var-imp-class</span> show us the variables that are the most globally important for making our classifications. How do those variables differ from what we saw in our linear regression model?</p>
<p>Since we have already seen that there isn’t much difference between models with regard to producing these plots, we will leave it up to you to produce localized plots for your classification models!</p>
</section>
</section>
</section>
<section id="wrapping-up" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="wrapping-up"><span class="header-section-number">3.4</span> Wrapping Up</h2>
<p>It is easy to get caught up in the excitement of creating a model and then using it to make predictions. It is also easy to get caught up in the excitement of seeing a model perform well on a test set. It is much harder to take a step back and ask yourself, “Is this model really doing what I want it to do?” You should always be looking at which variables are pulling the most weight in your model and how predictions are being made.</p>
</section>
<section id="additional-resources" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="additional-resources"><span class="header-section-number">3.5</span> Additional Resources</h2>
<p>If this chapter has piqued your curiosity, we would encourage you to check out the following resources.</p>
<p>Even though we did not use the <code>mlr3</code> package in this chapter, the <strong>Evaluation and Benchmarking</strong> chapter of the companion book, <a href="https://mlr3book.mlr-org.com/chapters/chapter3/evaluation_and_benchmarking.html">Applied Machine Learning Using mlr3 in R</a>, offers a great conceptual take on model metrics and evaluation.</p>
<p>For a more Pythonic look at model evaluation, we would highly recommend going through the sci-kit learn documentation on <a href="https://scikit-learn.org/stable/modules/model_evaluation.html">Model Evaluation</a>. It has you absolutely covered on code examples and concepts.</p>
<p>To get the most out of <code>DaLEX</code> visualizations, we would recommend checking out Christoph Molnar’s book, <a href="https://christophm.github.io/interpretable-ml-book/">Interpretable Machine Learning</a>. It is a great resource for learning more about model explainers and how to use them.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        for (let i = 0; i < 2; i++) {
          container.appendChild(note.children[i].cloneNode(true));
        }
        return container.innerHTML
      } else {
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        console.log("RESIZE");
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./linear_models.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The Foundation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./estimation.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">How Did We Get Here?</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>